[agent]
  interval = "1s"          # Recoge cada 1s para tiempo real
  round_interval = true
  flush_interval = "1s"    # Envía a InfluxDB cada 1s

[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "$INFLUX_TOKEN"  # De .env
  organization = "vdc"  # Cambia por la org real; si multi-org, haz un Telegraf por org o usa tags
  bucket = "iot_data"      # Estandarizado

[[inputs.mqtt_consumer]]
  servers = ["tcp://mosquitto:1883"]
  topics = [
    "#"                    # Suscríbete a todo; para restringir: "centro-profesional-vdc/#" o "+/+/+/+/+"
  ]
  data_format = "json"     # Asume payload JSON; si value simple, usa "value"
  username = ""            # Vacío si anónimo
  password = ""

  # Parsea el topic para tags (e.g., topic "location/zone/process/device/measures" ? tags en InfluxDB)
  topic_tag_parse = true
  topic_tag_keys = ["location", "zone", "process", "device"]  # Los primeros 4 niveles como tags; el último es el measurement
  topic_tag_exclude = []   # No excluye nada

[[processors.rename]]
  [[processors.rename.replace]]
    measurement = "*"      # Aplica a todos
    dest = "{{ .TopicMeasurement }}"  # Usa el último nivel del topic como measurement name (e.g., "temperatura")

[[processors.converter]]
  [processors.converter.fields]
    tag = ["unit"]         # Si el payload tiene "unit", conviértelo a tag (opcional para filtrado)

# Opcional: Agrega timestamp si no viene en payload
[[processors.date]]
  destination = "timestamp"
  format = "unix"